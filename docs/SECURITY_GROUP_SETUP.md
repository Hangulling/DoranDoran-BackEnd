# 보안 그룹 설정 가이드

## 🔒 현재 상황
- **퍼블릭 IP**: 3.21.177.186
- **인스턴스 ID**: i-09cef14bea7f6f62b
- **문제**: SSH 연결 실패 (Connection timed out)

## 🛠️ 해결 방법

### 1. AWS 콘솔에서 보안 그룹 설정

1. **EC2 콘솔 접속**
   - AWS 콘솔 → EC2 → Instances
   - 인스턴스 `i-09cef14bea7f6f62b` 선택

2. **보안 그룹 확인**
   - 인스턴스 상세 정보에서 "Security" 탭 클릭
   - 보안 그룹 ID 확인 (예: sg-xxxxxxxxx)

3. **보안 그룹 편집**
   - 보안 그룹 ID 클릭
   - "Inbound rules" 탭에서 "Edit inbound rules" 클릭

### 2. 필요한 포트 설정

다음 포트들을 열어주세요:

| 포트 | 프로토콜 | 소스 | 설명 |
|------|----------|------|------|
| 22 | TCP | 0.0.0.0/0 | SSH 접속 |
| 8080 | TCP | 0.0.0.0/0 | API Gateway |
| 8081 | TCP | 0.0.0.0/0 | Auth Service |
| 8082 | TCP | 0.0.0.0/0 | User Service |
| 8083 | TCP | 0.0.0.0/0 | Chat Service |
| 8085 | TCP | 0.0.0.0/0 | Batch Service |

### 3. 보안 그룹 규칙 추가

**SSH (포트 22) - 필수:**
- Type: SSH
- Protocol: TCP
- Port range: 22
- Source: 0.0.0.0/0 (또는 특정 IP)

**애플리케이션 포트들:**
- Type: Custom TCP
- Protocol: TCP
- Port range: 8080-8085
- Source: 0.0.0.0/0

### 4. 설정 완료 후 테스트

```bash
# SSH 연결 테스트
ssh -i "C:\Users\[사용자명]\Downloads\dorandoran-key.pem" ec2-user@3.21.177.186

# 서비스 포트 테스트
telnet 3.21.177.186 8080
telnet 3.21.177.186 8081
telnet 3.21.177.186 8082
telnet 3.21.177.186 8083
telnet 3.21.177.186 8085
```

## 🚨 주의사항

### 보안 고려사항
- **개발 환경**: 모든 포트를 0.0.0.0/0으로 열어도 됨
- **운영 환경**: 특정 IP 대역만 허용 권장
- **SSH**: 가능하면 특정 IP에서만 접속 허용

### 방화벽 설정
- Windows 방화벽이 SSH 연결을 차단할 수 있음
- 방화벽에서 포트 22 허용 확인

## 🔍 문제 해결

### SSH 연결 실패 시
1. **보안 그룹 확인**: 포트 22가 열려있는지 확인
2. **인스턴스 상태 확인**: 인스턴스가 실행 중인지 확인
3. **키 파일 권한**: Windows에서는 보통 문제없음
4. **네트워크**: 회사/학교 네트워크에서 SSH 차단 가능

### 포트 연결 실패 시
1. **보안 그룹**: 해당 포트가 열려있는지 확인
2. **애플리케이션**: 서비스가 실행 중인지 확인
3. **방화벽**: 로컬 방화벽 설정 확인

## 📞 추가 도움

보안 그룹 설정이 완료되면 다음 명령어로 배포를 진행하세요:

```powershell
# Chat 서비스만 배포
.\deploy-chat-only.ps1

# 전체 서비스 배포
.\deploy-aws.ps1 all prod
```
