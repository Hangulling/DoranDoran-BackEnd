<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DoranDoran Multi-Agent AI í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }
        
        .response-area {
            margin-top: 20px;
            padding: 20px;
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .sse-area {
            margin-top: 20px;
            padding: 20px;
            background: #34495e;
            color: #ecf0f1;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        .agent-info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .agent-info h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .agent-info ul {
            list-style: none;
            padding-left: 0;
        }
        
        .agent-info li {
            padding: 5px 0;
            border-bottom: 1px solid #bdc3c7;
        }
        
        .agent-info li:last-child {
            border-bottom: none;
        }
        
        /* Agent íƒ­ ìŠ¤íƒ€ì¼ */
        .agent-tabs {
            display: flex;
            border-bottom: 2px solid #e1e8ed;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
        }
        
        .agent-tab {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .agent-tab:hover {
            background: #e9ecef;
            color: #495057;
        }
        
        .agent-tab.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: white;
        }
        
        .agent-tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 0 0 8px 8px;
            border: 1px solid #e1e8ed;
            border-top: none;
        }
        
        .agent-tab-content.active {
            display: block;
        }
        
        .agent-tab-content h4 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– DoranDoran Multi-Agent AI í…ŒìŠ¤íŠ¸</h1>
            <p>ì™¸êµ­ì¸ í•œêµ­ì–´ í•™ìŠµì„ ìœ„í•œ Multi-Agent AI ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</p>
        </div>
        
        <div class="content">
            <!-- Agent ì •ë³´ -->
            <div class="agent-info">
                <h4>ğŸ¯ Multi-Agent êµ¬ì„±</h4>
                <ul>
                    <li><strong>IntimacyAgent</strong>: í•œêµ­ì–´ ì¹œë°€ë„ ë¶„ì„ ë° êµì • (1=ê²©ì‹ì²´, 2=ë¶€ë“œëŸ¬ìš´ ì¡´ëŒ“ë§, 3=ë°˜ë§)</li>
                    <li><strong>VocabularyAgent</strong>: ì–´ë ¤ìš´ ë‹¨ì–´ ì¶”ì¶œ (ìµœëŒ€ 1ê°œ)</li>
                    <li><strong>TranslationAgent</strong>: ì˜ì–´ ë²ˆì—­ ë° ë°œìŒê¸°í˜¸ ì œê³µ</li>
                    <li><strong>ConversationAgent</strong>: ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” ì‘ë‹µ ìƒì„±</li>
                </ul>
            </div>
            
            <div class="grid">
                <!-- ì±„íŒ…ë°© ìƒì„± í…ŒìŠ¤íŠ¸ -->
                <div class="test-section">
                    <h3>ğŸ  ì±„íŒ…ë°© ìƒì„± (AI ì¸ì‚¬ë§ ìë™ ë°œì†¡)</h3>
                    <div class="form-group">
                        <label for="userId">ì‚¬ìš©ì ID:</label>
                        <input type="text" id="userId" placeholder="UUID ë˜ëŠ” ì‚¬ìš©ì ID" value="test-user-123">
                    </div>
                    <div class="form-group">
                        <label for="chatbotId">ì±—ë´‡ ID:</label>
                        <input type="text" id="chatbotId" placeholder="ì±—ë´‡ UUID" value="test-bot-456">
                    </div>
                    <div class="form-group">
                        <label for="roomName">ì±„íŒ…ë°© ì´ë¦„:</label>
                        <input type="text" id="roomName" placeholder="ì±„íŒ…ë°© ì´ë¦„" value="í•œêµ­ì–´ í•™ìŠµë°©">
                    </div>
                    <div class="form-group">
                        <label for="intimacyLevel">ì¹œë°€ë„ ë ˆë²¨:</label>
                        <select id="intimacyLevel">
                            <option value="1">1 - ê²©ì‹ì²´/ì¡´ëŒ“ë§</option>
                            <option value="2" selected>2 - ë¶€ë“œëŸ¬ìš´ ì¡´ëŒ“ë§</option>
                            <option value="3">3 - ì¹œê·¼í•œ ë°˜ë§</option>
                        </select>
                    </div>
                    <button class="btn" onclick="createChatroom()">ì±„íŒ…ë°© ìƒì„±</button>
                    <button class="btn btn-secondary" onclick="clearResponse('createResponse')">ì‘ë‹µ ì§€ìš°ê¸°</button>
                    <div id="createStatus"></div>
                    <div id="createResponse" class="response-area" style="display: none;"></div>
                </div>
                
                <!-- ë©”ì‹œì§€ ì „ì†¡ í…ŒìŠ¤íŠ¸ -->
                <div class="test-section">
                    <h3>ğŸ’¬ ë©”ì‹œì§€ ì „ì†¡ (Multi-Agent ì²˜ë¦¬)</h3>
                    <div class="form-group">
                        <label for="chatroomId">ì±„íŒ…ë°© ID:</label>
                        <input type="text" id="chatroomId" placeholder="ìƒì„±ëœ ì±„íŒ…ë°© ID">
                    </div>
                    <div class="form-group">
                        <label for="messageContent">ë©”ì‹œì§€ ë‚´ìš©:</label>
                        <textarea id="messageContent" placeholder="í•œêµ­ì–´ë¡œ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">ì•ˆë…•í•˜ì„¸ìš”! í•œêµ­ì–´ë¥¼ ë°°ìš°ê³  ìˆì–´ìš”.</textarea>
                    </div>
                    <div class="form-group">
                        <label for="contentType">ë©”ì‹œì§€ íƒ€ì…:</label>
                        <select id="contentType">
                            <option value="text" selected>text</option>
                            <option value="code">code</option>
                            <option value="system">system</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
                    <button class="btn btn-secondary" onclick="clearResponse('messageResponse')">ì‘ë‹µ ì§€ìš°ê¸°</button>
                    <div id="messageStatus"></div>
                    <div id="messageResponse" class="response-area" style="display: none;"></div>
                </div>
            </div>
            
            <!-- SSE ìŠ¤íŠ¸ë¦¼ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h3>ğŸ“¡ SSE ìŠ¤íŠ¸ë¦¼ ì—°ê²° (ì‹¤ì‹œê°„ Agent ì‘ë‹µ)</h3>
                <div class="form-group">
                    <label for="streamChatroomId">ì±„íŒ…ë°© ID:</label>
                    <input type="text" id="streamChatroomId" placeholder="SSE ì—°ê²°í•  ì±„íŒ…ë°© ID">
                </div>
                <button class="btn" onclick="connectSSE()">SSE ì—°ê²°</button>
                <button class="btn btn-secondary" onclick="disconnectSSE()">ì—°ê²° í•´ì œ</button>
                <button class="btn btn-secondary" onclick="clearResponse('sseResponse')">ë¡œê·¸ ì§€ìš°ê¸°</button>
                <div id="sseStatus"></div>
                <div id="sseResponse" class="sse-area" style="display: none;"></div>
            </div>
            
            <!-- í”„ë¡¬í”„íŠ¸ í¸ì§‘ ì„¹ì…˜ -->
            <div class="test-section">
                <h3>âš™ï¸ Agent í”„ë¡¬í”„íŠ¸ í¸ì§‘</h3>
                
                <!-- Agent íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
                <div class="agent-tabs">
                    <button class="agent-tab active" onclick="switchAgentTab('conversation')">ğŸ’¬ ConversationAgent</button>
                    <button class="agent-tab" onclick="switchAgentTab('intimacy')">ğŸ¯ IntimacyAgent</button>
                    <button class="agent-tab" onclick="switchAgentTab('vocabulary')">ğŸ“š VocabularyAgent</button>
                    <button class="agent-tab" onclick="switchAgentTab('translation')">ğŸŒ TranslationAgent</button>
                </div>

                <!-- ConversationAgent íƒ­ -->
                <div id="conversation-tab" class="agent-tab-content active">
                    <h4>ğŸ’¬ ConversationAgent (ëŒ€í™”)</h4>
                    <div class="form-group">
                        <label for="conversationSystemPrompt">System Prompt:</label>
                        <textarea id="conversationSystemPrompt" rows="8" placeholder="System í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="conversationUserPrompt">User Prompt (ì„ íƒì‚¬í•­):</label>
                        <textarea id="conversationUserPrompt" rows="4" placeholder="User í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="conversationMetadata">ë©”íƒ€ë°ì´í„° (JSON):</label>
                        <textarea id="conversationMetadata" rows="6" placeholder="ì¶”ê°€ ë©”íƒ€ë°ì´í„°ë¥¼ JSON í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn" onclick="saveAgentPrompt('conversation')">ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="resetAgentPrompt('conversation')">ê¸°ë³¸ê°’ ë¦¬ì…‹</button>
                    <button class="btn btn-secondary" onclick="testAgentPrompt('conversation')">í…ŒìŠ¤íŠ¸</button>
                </div>

                <!-- IntimacyAgent íƒ­ -->
                <div id="intimacy-tab" class="agent-tab-content">
                    <h4>ğŸ¯ IntimacyAgent (ì¹œë°€ë„ ë¶„ì„)</h4>
                    <div class="form-group">
                        <label for="intimacySystemPrompt">System Prompt:</label>
                        <textarea id="intimacySystemPrompt" rows="8" placeholder="System í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="intimacyUserPrompt">User Prompt (ì„ íƒì‚¬í•­):</label>
                        <textarea id="intimacyUserPrompt" rows="4" placeholder="User í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="intimacyMetadata">ë©”íƒ€ë°ì´í„° (JSON):</label>
                        <textarea id="intimacyMetadata" rows="6" placeholder="ì¶”ê°€ ë©”íƒ€ë°ì´í„°ë¥¼ JSON í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn" onclick="saveAgentPrompt('intimacy')">ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="resetAgentPrompt('intimacy')">ê¸°ë³¸ê°’ ë¦¬ì…‹</button>
                    <button class="btn btn-secondary" onclick="testAgentPrompt('intimacy')">í…ŒìŠ¤íŠ¸</button>
                </div>

                <!-- VocabularyAgent íƒ­ -->
                <div id="vocabulary-tab" class="agent-tab-content">
                    <h4>ğŸ“š VocabularyAgent (ì–´íœ˜ ì¶”ì¶œ)</h4>
                    <div class="form-group">
                        <label for="vocabularySystemPrompt">System Prompt:</label>
                        <textarea id="vocabularySystemPrompt" rows="8" placeholder="System í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="vocabularyUserPrompt">User Prompt (ì„ íƒì‚¬í•­):</label>
                        <textarea id="vocabularyUserPrompt" rows="4" placeholder="User í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="vocabularyMetadata">ë©”íƒ€ë°ì´í„° (JSON):</label>
                        <textarea id="vocabularyMetadata" rows="6" placeholder="ì¶”ê°€ ë©”íƒ€ë°ì´í„°ë¥¼ JSON í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn" onclick="saveAgentPrompt('vocabulary')">ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="resetAgentPrompt('vocabulary')">ê¸°ë³¸ê°’ ë¦¬ì…‹</button>
                    <button class="btn btn-secondary" onclick="testAgentPrompt('vocabulary')">í…ŒìŠ¤íŠ¸</button>
                </div>

                <!-- TranslationAgent íƒ­ -->
                <div id="translation-tab" class="agent-tab-content">
                    <h4>ğŸŒ TranslationAgent (ë²ˆì—­)</h4>
                    <div class="form-group">
                        <label for="translationSystemPrompt">System Prompt:</label>
                        <textarea id="translationSystemPrompt" rows="8" placeholder="System í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="translationUserPrompt">User Prompt (ì„ íƒì‚¬í•­):</label>
                        <textarea id="translationUserPrompt" rows="4" placeholder="User í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="translationMetadata">ë©”íƒ€ë°ì´í„° (JSON):</label>
                        <textarea id="translationMetadata" rows="6" placeholder="ì¶”ê°€ ë©”íƒ€ë°ì´í„°ë¥¼ JSON í˜•íƒœë¡œ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button class="btn" onclick="saveAgentPrompt('translation')">ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="resetAgentPrompt('translation')">ê¸°ë³¸ê°’ ë¦¬ì…‹</button>
                    <button class="btn btn-secondary" onclick="testAgentPrompt('translation')">í…ŒìŠ¤íŠ¸</button>
                </div>

                <div id="promptStatus"></div>
            </div>

            <!-- API ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ -->
            <div class="test-section">
                <h3>ğŸ”— API ì—”ë“œí¬ì¸íŠ¸ ì •ë³´</h3>
                <div style="font-family: 'Courier New', monospace; background: #f8f9fa; padding: 15px; border-radius: 5px;">
                    <strong>Base URL:</strong> http://localhost:8083<br>
                    <strong>POST /api/chat/chatrooms</strong> - ì±„íŒ…ë°© ìƒì„±<br>
                    <strong>POST /api/chat/chatrooms/{id}/messages</strong> - ë©”ì‹œì§€ ì „ì†¡<br>
                    <strong>GET /api/chat/stream/{id}</strong> - SSE ìŠ¤íŠ¸ë¦¼ ì—°ê²°<br>
                    <strong>GET /api/chat/chatrooms</strong> - ì±„íŒ…ë°© ëª©ë¡<br>
                    <strong>GET /api/chat/chatrooms/{id}/messages</strong> - ë©”ì‹œì§€ ëª©ë¡
                </div>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:8083';
        let eventSource = null;
        
        // ì±„íŒ…ë°© ìƒì„±
        async function createChatroom() {
            const userId = document.getElementById('userId').value;
            const chatbotId = document.getElementById('chatbotId').value;
            const roomName = document.getElementById('roomName').value;
            const intimacyLevel = document.getElementById('intimacyLevel').value;
            
            if (!userId || !chatbotId || !roomName) {
                showStatus('createStatus', 'error', 'ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showStatus('createStatus', 'info', 'ì±„íŒ…ë°© ìƒì„± ì¤‘...');
            
            try {
                const response = await fetch(`${BASE_URL}/api/chat/chatrooms`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-Id': userId
                    },
                    body: JSON.stringify({
                        userId: userId,
                        chatbotId: chatbotId,
                        name: roomName,
                        intimacyLevel: parseInt(intimacyLevel)
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showStatus('createStatus', 'success', 'ì±„íŒ…ë°© ìƒì„± ì„±ê³µ!');
                    showResponse('createResponse', JSON.stringify(data, null, 2));
                    
                    // ìƒì„±ëœ ì±„íŒ…ë°© IDë¥¼ ë‹¤ë¥¸ í•„ë“œì— ìë™ ì…ë ¥
                    document.getElementById('chatroomId').value = data.id;
                    document.getElementById('streamChatroomId').value = data.id;
                } else {
                    showStatus('createStatus', 'error', `ì˜¤ë¥˜: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                    showResponse('createResponse', JSON.stringify(data, null, 2));
                }
            } catch (error) {
                showStatus('createStatus', 'error', `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
                showResponse('createResponse', `Error: ${error.message}`);
            }
        }
        
        // ë©”ì‹œì§€ ì „ì†¡
        async function sendMessage() {
            const chatroomId = document.getElementById('chatroomId').value;
            const content = document.getElementById('messageContent').value;
            const contentType = document.getElementById('contentType').value;
            const userId = document.getElementById('userId').value;
            
            if (!chatroomId || !content) {
                showStatus('messageStatus', 'error', 'ì±„íŒ…ë°© IDì™€ ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            showStatus('messageStatus', 'info', 'ë©”ì‹œì§€ ì „ì†¡ ì¤‘... (Multi-Agent ì²˜ë¦¬)');
            
            try {
                const response = await fetch(`${BASE_URL}/api/chat/chatrooms/${chatroomId}/messages`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-Id': userId
                    },
                    body: JSON.stringify({
                        content: content,
                        contentType: contentType,
                        senderType: 'user'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showStatus('messageStatus', 'success', 'ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ! Multi-Agentê°€ ì²˜ë¦¬ ì¤‘...');
                    showResponse('messageResponse', JSON.stringify(data, null, 2));
                    
                    // SSE ì—°ê²°ì´ ë˜ì–´ìˆë‹¤ë©´ ì‹¤ì‹œê°„ ì‘ë‹µì„ ë³¼ ìˆ˜ ìˆìŒ
                    if (eventSource) {
                        addSSELog('ğŸ“¤ ì‚¬ìš©ì ë©”ì‹œì§€ ì „ì†¡ë¨: ' + content);
                    }
                } else {
                    showStatus('messageStatus', 'error', `ì˜¤ë¥˜: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                    showResponse('messageResponse', JSON.stringify(data, null, 2));
                }
            } catch (error) {
                showStatus('messageStatus', 'error', `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`);
                showResponse('messageResponse', `Error: ${error.message}`);
            }
        }
        
        // SSE ì—°ê²°
        function connectSSE() {
            const chatroomId = document.getElementById('streamChatroomId').value;
            
            if (!chatroomId) {
                showStatus('sseStatus', 'error', 'ì±„íŒ…ë°© IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (eventSource) {
                eventSource.close();
            }
            
            showStatus('sseStatus', 'info', 'SSE ì—°ê²° ì¤‘...');
            showResponse('sseResponse', '');
            
            eventSource = new EventSource(`${BASE_URL}/api/chat/stream/${chatroomId}?userId=${document.getElementById('userId').value}`);
            
            eventSource.onopen = function() {
                showStatus('sseStatus', 'success', 'SSE ì—°ê²°ë¨! ì‹¤ì‹œê°„ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...');
                addSSELog('ğŸ”— SSE ì—°ê²° ì„±ê³µ');
            };
            
            eventSource.onmessage = function(event) {
                addSSELog('ğŸ“¨ ì¼ë°˜ ë©”ì‹œì§€: ' + event.data);
            };
            
            // Multi-Agent ì´ë²¤íŠ¸ íƒ€ì…ë“¤
            eventSource.addEventListener('intimacy_analysis', function(event) {
                const data = JSON.parse(event.data);
                addSSELog('ğŸ¯ IntimacyAgent: ' + JSON.stringify(data, null, 2));
            });
            
            eventSource.addEventListener('vocabulary_extracted', function(event) {
                const data = JSON.parse(event.data);
                addSSELog('ğŸ“š VocabularyAgent: ' + JSON.stringify(data, null, 2));
            });
            
            eventSource.addEventListener('vocabulary_translated', function(event) {
                const data = JSON.parse(event.data);
                addSSELog('ğŸŒ TranslationAgent: ' + JSON.stringify(data, null, 2));
            });
            
            eventSource.addEventListener('conversation_chunk', function(event) {
                addSSELog('ğŸ’¬ ConversationAgent (ìŠ¤íŠ¸ë¦¼): ' + event.data);
            });
            
            eventSource.addEventListener('conversation_complete', function(event) {
                const data = JSON.parse(event.data);
                addSSELog('âœ… ConversationAgent ì™„ë£Œ: ' + JSON.stringify(data, null, 2));
            });
            
            eventSource.addEventListener('aggregated_complete', function(event) {
                const data = JSON.parse(event.data);
                addSSELog('ğŸ‰ ì „ì²´ ê²°ê³¼ ì§‘ê³„: ' + JSON.stringify(data, null, 2));
            });
            
            eventSource.addEventListener('ai_info', function(event) {
                addSSELog('â„¹ï¸ AI ì •ë³´: ' + event.data);
            });
            
            eventSource.addEventListener('ai_error', function(event) {
                addSSELog('âŒ AI ì˜¤ë¥˜: ' + event.data);
            });
            
            eventSource.onerror = function(event) {
                showStatus('sseStatus', 'error', 'SSE ì—°ê²° ì˜¤ë¥˜');
                addSSELog('âŒ SSE ì—°ê²° ì˜¤ë¥˜');
            };
        }
        
        // SSE ì—°ê²° í•´ì œ
        function disconnectSSE() {
            if (eventSource) {
                eventSource.close();
                eventSource = null;
                showStatus('sseStatus', 'info', 'SSE ì—°ê²° í•´ì œë¨');
                addSSELog('ğŸ”Œ SSE ì—°ê²° í•´ì œ');
            }
        }
        
        // ìƒíƒœ í‘œì‹œ
        function showStatus(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // ì‘ë‹µ í‘œì‹œ
        function showResponse(elementId, content) {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.style.display = 'block';
        }
        
        // SSE ë¡œê·¸ ì¶”ê°€
        function addSSELog(message) {
            const element = document.getElementById('sseResponse');
            const timestamp = new Date().toLocaleTimeString();
            element.textContent += `[${timestamp}] ${message}\n`;
            element.style.display = 'block';
            element.scrollTop = element.scrollHeight;
        }
        
        // ì‘ë‹µ ì§€ìš°ê¸°
        function clearResponse(elementId) {
            const element = document.getElementById(elementId);
            element.textContent = '';
            element.style.display = 'none';
        }
        
        // í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ë°ì´í„°
        const promptTemplates = {
            conversation: {
                systemPrompt: `ë‹¹ì‹ ì€ ë„ë€ë„ë€ì˜ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤. ì™¸êµ­ì¸ í•œêµ­ì–´ í•™ìŠµìë¥¼ ë„ì™€ì£¼ëŠ” ì¹œê·¼í•œ íŠœí„°ì…ë‹ˆë‹¤.

ì£¼ìš” ì—­í• :
- í•œêµ­ì–´ í•™ìŠµì— ëŒ€í•œ ì§ˆë¬¸ì— ì •í™•í•˜ê³  ë„ì›€ì´ ë˜ëŠ” ë‹µë³€ ì œê³µ
- í•™ìŠµìì˜ ë ˆë²¨ì— ë§ëŠ” ì ì ˆí•œ ì–¸ì–´ ì‚¬ìš©
- ê²©ë ¤ì™€ ë™ê¸°ë¶€ì—¬ë¥¼ í†µí•œ í•™ìŠµ ì§€ì›
- í•œêµ­ ë¬¸í™”ì™€ ì–¸ì–´ì˜ ë§¥ë½ ì„¤ëª…

ì‘ë‹µ ìŠ¤íƒ€ì¼:
- ì¹œê·¼í•˜ê³  ê²©ë ¤ì ì¸ í†¤
- ëª…í™•í•˜ê³  ì´í•´í•˜ê¸° ì‰¬ìš´ ì„¤ëª…
- êµ¬ì²´ì ì¸ ì˜ˆì‹œ ì œê³µ
- í•™ìŠµìì˜ ì§„ì „ì„ ì¸ì •í•˜ê³  ê²©ë ¤

- ì‘ë‹µì€ í•œêµ­ì–´ë¡œ, í•µì‹¬ ìœ„ì£¼ë¡œ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”.`,
                userPrompt: "",
                metadata: {
                    "agentType": "conversation",
                    "maxTokens": 800,
                    "temperature": 0.7,
                    "responseFormat": "stream"
                }
            },
            intimacy: {
                systemPrompt: `ë‹¹ì‹ ì€ ì™¸êµ­ì¸ì˜ í•œêµ­ì–´ ì¹œë°€ë„ë¥¼ ë¶„ì„í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ë¶„ì„ ê¸°ì¤€:
- 1ë‹¨ê³„ (ê²©ì‹ì²´/ì¡´ëŒ“ë§): "~ìŠµë‹ˆë‹¤", "~ì…ë‹ˆë‹¤", "~í•˜ê² ìŠµë‹ˆë‹¤"
- 2ë‹¨ê³„ (ë¶€ë“œëŸ¬ìš´ ì¡´ëŒ“ë§): "~í•´ìš”", "~ì´ì—ìš”", "~ìˆì–´ìš”"  
- 3ë‹¨ê³„ (ì¹œê·¼í•œ ë°˜ë§): "~ì•¼", "~ì–´", "~ì§€"

í˜„ì¬ í•™ìŠµìì˜ ëª©í‘œ ë ˆë²¨: {level} (1=ê²©ì‹ì²´/ì¡´ëŒ“ë§, 2=ë¶€ë“œëŸ¬ìš´ ì¡´ëŒ“ë§, 3=ì¹œê·¼í•œ ë°˜ë§)

ë‹¤ìŒ ë¬¸ì¥ì„ ë¶„ì„í•˜ì—¬ JSON í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”:
{
  "detectedLevel": 1-3,
  "correctedSentence": "êµì •ëœ ë¬¸ì¥",
  "feedback": "í”¼ë“œë°± ë©”ì‹œì§€",
  "corrections": ["ë³€ê²½ì‚¬í•­1", "ë³€ê²½ì‚¬í•­2"]
}`,
                userPrompt: "{userMessage}",
                metadata: {
                    "agentType": "intimacy",
                    "level": 1,
                    "responseFormat": "json"
                }
            },
            vocabulary: {
                systemPrompt: `ì™¸êµ­ì¸ì´ ì´í•´í•˜ê¸° ì–´ë ¤ìš´ í•œêµ­ì–´ ë‹¨ì–´/í‘œí˜„ì„ ìµœëŒ€ 1ê°œ ì¶”ì¶œí•˜ì„¸ìš”.

ì¶”ì¶œ ê¸°ì¤€:
- ë¬¸ë²•ì ìœ¼ë¡œ ë³µì¡í•œ êµ¬ì¡°
- í•œêµ­ì–´ íŠ¹ìœ ì˜ í‘œí˜„
- ë¬¸í™”ì  ë§¥ë½ì´ í•„ìš”í•œ ë‹¨ì–´
- í•™ìŠµì ë ˆë²¨ì— ë§ëŠ” ì ì ˆí•œ ë‚œì´ë„

ì‚¬ìš©ì ë ˆë²¨: {userLevel} (1=ì´ˆê¸‰, 2=ì¤‘ê¸‰, 3=ê³ ê¸‰)

JSON í˜•ì‹:
{
  "words": [
    {"word": "ë‹¨ì–´", "difficulty": 1-3, "context": "ë¬¸ë§¥"}
  ]
}`,
                userPrompt: "{userMessage}",
                metadata: {
                    "agentType": "vocabulary",
                    "userLevel": 1,
                    "maxWords": 1,
                    "responseFormat": "json"
                }
            },
            translation: {
                systemPrompt: `í•œêµ­ì–´ ë‹¨ì–´ë¥¼ ì˜ì–´ë¡œ ë²ˆì—­í•˜ê³  ë°œìŒê¸°í˜¸ë¥¼ ì œê³µí•˜ì„¸ìš”.

ë²ˆì—­ ê¸°ì¤€:
- ì •í™•í•œ ì˜ì–´ ë²ˆì—­
- ë°œìŒê¸°í˜¸ (IPA ë˜ëŠ” í•œê¸€ ë°œìŒ)
- ê°„ë‹¨í•œ ì„¤ëª…ì´ë‚˜ ì˜ˆì‹œ

JSON í˜•ì‹:
{
  "translations": [
    {"original": "í•œêµ­ì–´", "english": "English", "pronunciation": "[ë°œìŒê¸°í˜¸]"}
  ]
}`,
                userPrompt: "ë‹¤ìŒ í•œêµ­ì–´ ë‹¨ì–´ë“¤ì„ ë²ˆì—­í•´ì£¼ì„¸ìš”:\n{words}",
                metadata: {
                    "agentType": "translation",
                    "responseFormat": "json"
                }
            }
        };

        // Agent íƒ­ ì „í™˜
        function switchAgentTab(agentType) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì½˜í…ì¸  ë¹„í™œì„±í™”
            document.querySelectorAll('.agent-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.agent-tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ê³¼ ì½˜í…ì¸  í™œì„±í™”
            document.querySelector(`[onclick="switchAgentTab('${agentType}')"]`).classList.add('active');
            document.getElementById(`${agentType}-tab`).classList.add('active');
        }

        // Agent í”„ë¡¬í”„íŠ¸ ë¡œë“œ
        function loadAgentPrompt(agentType) {
            const template = promptTemplates[agentType];
            
            document.getElementById(`${agentType}SystemPrompt`).value = template.systemPrompt;
            document.getElementById(`${agentType}UserPrompt`).value = template.userPrompt;
            document.getElementById(`${agentType}Metadata`).value = JSON.stringify(template.metadata, null, 2);
        }

        // Agent í”„ë¡¬í”„íŠ¸ ì €ì¥
        function saveAgentPrompt(agentType) {
            const systemPrompt = document.getElementById(`${agentType}SystemPrompt`).value;
            const userPrompt = document.getElementById(`${agentType}UserPrompt`).value;
            let metadata = {};
            
            try {
                metadata = JSON.parse(document.getElementById(`${agentType}Metadata`).value);
            } catch (e) {
                showStatus('promptStatus', 'error', `${agentType} Agent: ë©”íƒ€ë°ì´í„° JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.`);
                return;
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const promptData = {
                systemPrompt: systemPrompt,
                userPrompt: userPrompt,
                metadata: metadata
            };
            
            localStorage.setItem(`prompt_${agentType}`, JSON.stringify(promptData));
            showStatus('promptStatus', 'success', `${agentType} Agent í”„ë¡¬í”„íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        // Agent í”„ë¡¬í”„íŠ¸ ë¦¬ì…‹
        function resetAgentPrompt(agentType) {
            loadAgentPrompt(agentType);
            showStatus('promptStatus', 'info', `${agentType} Agent: ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ë¡œ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // Agent í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸
        function testAgentPrompt(agentType) {
            const systemPrompt = document.getElementById(`${agentType}SystemPrompt`).value;
            const userPrompt = document.getElementById(`${agentType}UserPrompt`).value;
            const metadata = JSON.parse(document.getElementById(`${agentType}Metadata`).value);
            
            // í…ŒìŠ¤íŠ¸ìš© ë©”ì‹œì§€
            const testMessage = document.getElementById('messageContent').value || "ì•ˆë…•í•˜ì„¸ìš”! í•œêµ­ì–´ë¥¼ ë°°ìš°ê³  ìˆì–´ìš”.";
            
            showStatus('promptStatus', 'info', `${agentType} Agent í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸ ì¤‘...`);
            
            try {
                // ë³€ìˆ˜ ì¹˜í™˜
                let processedUserPrompt = userPrompt
                    .replace('{userMessage}', testMessage)
                    .replace('{level}', metadata.level || 1)
                    .replace('{userLevel}', metadata.userLevel || 1)
                    .replace('{words}', testMessage);
                
                const promptData = {
                    agentType: agentType,
                    systemPrompt: systemPrompt,
                    userPrompt: processedUserPrompt,
                    metadata: metadata,
                    testMessage: testMessage
                };
                
                showStatus('promptStatus', 'success', `${agentType} Agent: í”„ë¡¬í”„íŠ¸ êµ¬ì¡°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                console.log(`${agentType} Agent Prompt Data:`, promptData);
                
                // í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                const preview = `
=== ${agentType.toUpperCase()} AGENT í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸° ===

System Prompt:
${systemPrompt}

User Prompt:
${processedUserPrompt}

Metadata:
${JSON.stringify(metadata, null, 2)}

Test Message: ${testMessage}
                `;
                
                alert(preview);
                
            } catch (error) {
                showStatus('promptStatus', 'error', `${agentType} Agent í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ê°’ ì„¤ì •
        window.onload = function() {
            // UUID ìƒì„± í•¨ìˆ˜
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            
            // ê¸°ë³¸ UUID ì„¤ì • (ì‹¤ì œ í…ŒìŠ¤íŠ¸ ID ì‚¬ìš©)
            document.getElementById('userId').value = '3fa85f64-5717-4562-b3fc-2c963f66afa6';
            document.getElementById('chatbotId').value = '3fa85f64-5717-4562-b3fc-2c963f66afa7';
            
            // ëª¨ë“  Agent í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì´ˆê¸° ë¡œë“œ
            ['conversation', 'intimacy', 'vocabulary', 'translation'].forEach(agentType => {
                loadAgentPrompt(agentType);
            });
        };
    </script>
</body>
</html>
