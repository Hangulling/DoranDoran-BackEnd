graph TB
    subgraph "Client Layer"
        WebClient[웹 클라이언트]
        MobileClient[모바일 앱]
    end

    subgraph "API Layer"
        ChatController[Chat Controller]
        SSEController[SSE Controller]
        WebSocketHandler[WebSocket Handler]
    end

    subgraph "Service Layer"
        ChatService[Chat Service]
        MultiAgentOrchestrator[Multi-Agent<br/>Orchestrator]
        PromptService[Prompt Service]
        SSEManager[SSE Manager]
    end

    subgraph "AI Agent Layer"
        IntimacyAgent[Intimacy Agent<br/>친밀도 분석]
        VocabularyAgent[Vocabulary Agent<br/>어휘 추출]
        TranslationAgent[Translation Agent<br/>번역]
        ConversationAgent[Conversation Agent<br/>대화 생성]
    end

    subgraph "External AI Services"
        OpenAI[OpenAI API<br/>GPT Models]
    end

    subgraph "Data Layer"
        ChatDB[(Chat Database<br/>PostgreSQL)]
        Redis[(Redis Cache)]
    end

    subgraph "Integration Layer"
        UserServiceClient[User Service<br/>Feign Client]
        AuthServiceClient[Auth Service<br/>Feign Client]
    end

    %% Client to API
    WebClient --> ChatController
    WebClient --> SSEController
    WebClient --> WebSocketHandler
    MobileClient --> ChatController
    MobileClient --> SSEController

    %% API to Service
    ChatController --> ChatService
    SSEController --> SSEManager
    WebSocketHandler --> ChatService

    %% Service to Orchestrator
    ChatService --> MultiAgentOrchestrator
    MultiAgentOrchestrator --> PromptService

    %% Orchestrator to Agents
    MultiAgentOrchestrator --> IntimacyAgent
    MultiAgentOrchestrator --> VocabularyAgent
    MultiAgentOrchestrator --> TranslationAgent
    MultiAgentOrchestrator --> ConversationAgent

    %% Agents to OpenAI
    IntimacyAgent --> OpenAI
    VocabularyAgent --> OpenAI
    TranslationAgent --> OpenAI
    ConversationAgent --> OpenAI

    %% Service to Data
    ChatService --> ChatDB
    ChatService --> Redis
    MultiAgentOrchestrator --> ChatDB

    %% Service to Integration
    ChatService --> UserServiceClient
    ChatService --> AuthServiceClient

    %% SSE Manager to Client
    SSEManager --> SSEController
